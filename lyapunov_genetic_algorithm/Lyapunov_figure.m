
% clc
% clear
x_axis=0:0.001:2.5;
y_axis=0:0.001:2.5;

m=size(x_axis,2);
n=size(y_axis,2);

u1=zeros(m*n,1);
u2=zeros(m*n,1);
max_u11=0;
max_u12=0;
min_u1=1000;

x1_1=zeros(m*n,1);
x2_1=zeros(m*n,1);

x1_2=zeros(m*n,1);
x2_2=zeros(m*n,1);

x1_3=zeros(m*n,1);
x2_3=zeros(m*n,1);

x1_4=zeros(m*n,1);
x2_4=zeros(m*n,1);

x1_5=zeros(m*n,1);
x2_5=zeros(m*n,1);

for i=1:m
    for j=1:n
        u1( (i-1)*n+j )=x_axis(i);
        u2( (i-1)*n+j )=y_axis(j);
    end
end

score=1;

% x_o2=[4.4595   12.1081   10.7870    0.1134];
% x_o=[1   2   1    1];
% x=[6.29140176240786,7.40312989044452,7.71249014388120,3.11220991143695,4.77342487509691,2.96547029511683,3.62093555326902,5.85255203285817,1.49504534885141,9.14416891635604,3.02304921199904,0.905756902578500,0.956203619789844,7.64486875278753,3.49525009839326,0.454250329095063,7.12223744263415,1.69185403958707,3.35590055523067,6.16689867525303,3.33775897045511,7.91645172831221,2.54768222845182,2.58900230506379]
% 3,4

% x2=[15.3410577512253,107.288300802618,1.72707387554316,47.4082292222562,67.3361105395089,115.426519424393,33.4516104440043,95.2614172393100,38.3018675063321,140.835140727798,86.5434498578030,2.26520342561447,55.2154552605688,34.8006382645027,77.9342079927754,93.1002205391334,7.12223744263415,1.69185403958707,3.35590055523067,6.16689867525303,3.33775897045511,7.91645172831221,2.54768222845182,2.58900230506379]

% [1.49504534885141,9.14416891635604,3.02304921199904,0.905756902578500,0.956203619789844,7.64486875278753,3.49525009839326,0.454250329095063]
% x=[15.3410577512253,107.288300802618,1.72707387554316,47.4082292222562,67.3361105395089,115.426519424393,33.4516104440043,95.2614172393100,38.3018675063321,140.835140727798,86.5434498578030,2.26520342561447,55.2154552605688,34.8006382645027,77.9342079927754,93.1002205391334,1.49504534885141,9.14416891635604,3.02304921199904,0.905756902578500,0.956203619789844,7.64486875278753,3.49525009839326,0.454250329095063]

x=[6.29,7.40,7.71,3.11,4.77,2.97,3.62,5.85,1.50,9.14,3.02,0.91,0.96,7.64,3.50,0.45,7.12,1.69,3.36,6.17,3.34,7.92,2.55,2.59]

is_valid=true;
max_x1=0;
max_u1=0;
max_u2=0;
h=0.6;
  
for i=1:m*n
    P1=[x(1), -x(3)*h; 
       -x(4)*h, x(2)*h^2];
    P2=[x(5), -x(7)*h; 
       -x(8)*h, x(6)*h^2];
    P3=[x(9), -x(11)*h; 
       -x(12)*h, x(10)*h^2]; 
    P4=[x(13), -x(15)*h; 
       -x(16)*h, x(14)*h^2];
    P5=[x(17), -x(19)*h; 
       -x(20)*h, x(18)*h^2]; 
    P6=[x(21), -x(23)*h; 
       -x(24)*h, x(22)*h^2]; 
    M1=[u1(i)-1,h; (u2(i)-1)/h,1];
    
    DV1=-(M1'*P1*M1-P1);
    DV2=-(M1'*P2*M1-P2);
    DV3=-(M1'*P3*M1-P3);
    DV4=-(M1'*P4*M1-P4);
    DV5=-(M1'*P5*M1-P5);
    DV6=-(M1'*P6*M1-P6);

%     if  ((det(DV3)>=0 && DV3(1,1)>=0)&&(det(P3)>0 && P3(1,1)>0))||...
%         ((det(DV4)>=0 && DV4(1,1)>=0)&&(det(P4)>0 && P4(1,1)>0))
%         x1_1(i)=u1(i); x2_1(i)=u2(i);
%     else
%         x1_1(i)=0; x2_1(i)=0;
%     end    

    if((det(DV1)>0 && DV1(1,1)>0 && det(P1)>0 && P1(1,1)>0)||...
      (det(DV2)>0 && DV2(1,1)>0 && det(P2)>0 && P2(1,1)>0)||...
      (det(DV3)>0 && DV3(1,1)>0 && det(P3)>0 && P3(1,1)>0)||...
      (det(DV4)>0 && DV4(1,1)>0 && det(P4)>0 && P4(1,1)>0)||...
      (det(DV5)>0 && DV5(1,1)>0 && det(P5)>0 && P5(1,1)>0)||...
      (det(DV6)>0 && DV6(1,1)>0 && det(P6)>0 && P6(1,1)>0))
        x1_1(i)=u1(i); x2_1(i)=u2(i);
    else
        x1_1(i)=0; x2_1(i)=0;
    end       
    
    if ((u1(i)>=0 && u1(i)<2 && u2(i)>=0 && u2(i)<=1) && (u2(i)>u1(i)/2 && u2(i)<=u1(i)))||(u1(i)==0 && u2(i)==0) 
       x1_2(i)=u1(i); x2_2(i)=u2(i);
    else
       x1_2(i)=0; x2_2(i)=0;
    end


    if ( ((u1(i)>=0 && u1(i)<2 && u2(i)>=0 && u2(i)<=1) && (u2(i)>=u1(i)/2 && u2(i)<=u1(i)))&&...
         ~((det(DV1)>0 && DV1(1,1)>0 && det(P1)>0 && P1(1,1)>0)||...
          (det(DV2)>0 && DV2(1,1)>0 && det(P2)>0 && P2(1,1)>0)||...
          (det(DV3)>0 && DV3(1,1)>0 && det(P3)>0 && P3(1,1)>0)||...
          (det(DV4)>0 && DV4(1,1)>0 && det(P4)>0 && P4(1,1)>0)||...
          (det(DV5)>0 && DV5(1,1)>0 && det(P5)>0 && P5(1,1)>0)||...
          (det(DV6)>0 && DV6(1,1)>0 && det(P6)>0 && P6(1,1)>0)))
        x1_3(i)=u1(i); x2_3(i)=u2(i);
        if (u1(i)<min_u1)
            min_u1=u1(i);
        end 
    else
        x1_3(i)=0; x2_3(i)=0;
    end
    
end


set(gcf,'position',[600,40,468,350],'PaperPositionMode','auto');
set(gcf,'color','w');
p1_axis = gca; 
scatter(x1_1,x2_1,0.1,...
                    'LineWidth',0.01,...  
                    'DisplayName','$ \mathcal K $',...
                    'MarkerEdgeColor',[0.0745098039215686 0.623529411764706 1],...
                    'MarkerFaceColor',[0.0745098039215686 0.623529411764706 1] ); 
hold on
scatter(x1_2,x2_2,0.1,...
                    'LineWidth',0.01,...  
                    'DisplayName','$ \mathcal K $',...
                    'MarkerEdgeColor',[0.568627450980392 0.258823529411765 0.858823529411765],...
                    'MarkerFaceColor',[0.568627450980392 0.258823529411765 0.858823529411765] );
hold on
scatter(x1_3,x2_3,0.1,...
                    'LineWidth',0.01,...  
                    'DisplayName','$ \mathcal K $',...
                    'MarkerEdgeColor',[1 0.2 0.1],...
                    'MarkerFaceColor',[1 0.2 0.1] );
                
% scatter(x1_5,x2_5,0.1,...
%                     'LineWidth',0.01,...  
%                     'DisplayName','$ \mathcal K $',...
%                     'MarkerEdgeColor',[0.1 0.2 0.1],...
%                     'MarkerFaceColor',[0.1 0.2 0.1] ); 
                            
xlabel('$ {{\hat{u}}_{1,k}} $','Interpreter','latex');
ylabel('$ {{\hat{u}}_{2,k}} $','Interpreter','latex');