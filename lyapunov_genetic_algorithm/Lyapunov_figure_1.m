
clc
clear
x_axis=0:0.005:2;
y_axis=0:0.005:2;

m=size(x_axis,2);
n=size(y_axis,2);

u1=zeros(m*n,1);
u2=zeros(m*n,1);

min_u1=1000;
u2_max_set=1;

x1_1=zeros(m*n,1);
x2_1=zeros(m*n,1);

x1_2=zeros(m*n,1);
x2_2=zeros(m*n,1);

x1_3=zeros(m*n,1);
x2_3=zeros(m*n,1);

x1_4=zeros(m*n,1);
x2_4=zeros(m*n,1);

x1_5=zeros(m*n,1);
x2_5=zeros(m*n,1);

for i=1:m
    for j=1:n
        u1( (i-1)*n+j )=x_axis(i);
        u2( (i-1)*n+j )=y_axis(j);
    end
end

score=1;
% x_o=[1   2   1    1];

% [1.49504534885141,9.14416891635604,3.02304921199904,0.905756902578500,0.956203619789844,7.64486875278753,3.49525009839326,0.454250329095063]
% x=[15.3410577512253,107.288300802618,1.72707387554316,47.4082292222562,67.3361105395089,115.426519424393,33.4516104440043,95.2614172393100,38.3018675063321,140.835140727798,86.5434498578030,2.26520342561447,55.2154552605688,34.8006382645027,77.9342079927754,93.1002205391334,1.49504534885141,9.14416891635604,3.02304921199904,0.905756902578500,0.956203619789844,7.64486875278753,3.49525009839326,0.454250329095063]

% x=[5.29004602370707,6.27878970494364,2.19014031470241,6.30500358473331,1.38471122824842,5.67707871094981,3.48199883867618,0.0826695143320430]
% x=[5.29004602370707,6.27878970494364,2.22139031470241,6.31281608473331,1.32221122824842,5.67707871094981,3.48199883867618,0.0826695143320430]
% 
% x=[1,2,-1,-1,1,2,-1,-1]
% x=[0.247740406604926,-0.730212897742746,-9.55198065581338,8.98279861696297]

% x=[0.248,-0.730,-9.552,8.983]
% x=[0.0333456174371782,-3.89676716857037,-8.32508509295567,8.44224693484357]
% x=[0.0143930364239943,-2.18000503521518,-3.64348050698233,3.34410966274402]

% x=[0.0333456174371782,-3.89676716857037,-8.32508509295567,8.44224693484357]
% x=[5.51425357216805,7.55147868615320,2.03136696716944,8.19205063722469]
% x=[5.54481073097886,8.24437794073319,6.96980718111321,4.22903832736599];
% x=[6.06728783204881,7.99301981018162,5.07472148266123,6.62377241068337]
x=[1,2,1,1];
% x=[1,1,-1,1]
% x=[2.46179513515200,6.69801547096361,1.72152835608179,4.35482318314934]
% x=[0.124220754742012,8.71846416637056,-3.97738172081176,5.15615381182971]
% x=[0.188530543584212,6.73776248375307,-4.78079587007875,5.22543189035555];
% x=[0.174581292036767,8.81253466736167,-1.13194315679354,1.30970216035626]
% x=[5.76015489201881,8.46169747707998,3.04389234963851,5.57989931210670]
% x=[0.537667139546100,1.83388501459509,-2.25884686100365,0.862173320368121]

is_valid=true;
max_x1=0;
max_u1=0;
max_u2=0;
h=0.6;
score=1;


for i=1:m*n
%     x=[1,2,1.5,1];h=0.6;
    P1=[x(1), -x(3)*h; 
       -x(3)*h, x(2)*h^2];
    P1S=(P1+P1')/2;
    P1S_eig=real(eig(P1S));

    M1=[u1(i)-1,h; (u2(i)-1)/h,1];
    
%     DV1=-(M1'*P1*M1-P1);
    a=x(1);
    b=x(2);
    c=-x(3);
    d=-x(4);
    DV1=[a-a*(u1(i)-1)^2-(c+d)*(u1(i)-1)*(u2(i)-1)-b*(u2(i)-1)^2, h*(d-(a+d)*(u1(i)-1)-(c+b)*(u2(i)-1));
        h*(c-(a+c)*(u1(i)-1)-(d+b)*(u2(i)-1)), h^2*(-a-c-d)];
    
    DV1S=(DV1+DV1')/2;
    DV1S_eig=real(eig(DV1S));

%     if(DV1S_eig(1)>0 && DV1S_eig(2)>0 && P1S_eig(1)>0 && P1S_eig(2)>0)
%         x1_1(i)=u1(i); x2_1(i)=u2(i);
%     else
%         x1_1(i)=0; x2_1(i)=0;
%     end       

    if(DV1S_eig(1)>0 && DV1S_eig(2)>0 && P1S_eig(1)>0 && P1S_eig(2)>0) 
        x1_1(i)=u1(i); x2_1(i)=u2(i);
    else
        x1_1(i)=0; x2_1(i)=0;
    end       
    

    if (((u1(i)>=0 && u1(i)<2 && u2(i)>=0 && u2(i)<=u2_max_set) && (u2(i)>=u1(i)/2 && u2(i)<=u1(i)))&&...
         (DV1S_eig(1)>0 && DV1S_eig(2)>0 && P1S_eig(1)>0 && P1S_eig(2)>0) && (u1(i)~=0 && u2(i)~=0))
       x1_2(i)=u1(i); x2_2(i)=u2(i);
    else
       x1_2(i)=0; x2_2(i)=0;
    end

% &&...
%        ~((u1(i)>=0 && u1(i)<=2 && u2(i)>=0 && u2(i)<=u2_max_set) && (u2(i)>=u1(i)/2 && u2(i)<=u1(i)))
%     
    
    if (((u1(i)>=0 && u1(i)<2 && u2(i)>=0 && u2(i)<=u2_max_set) && (u2(i)>= u1(i)/2 && u2(i)<=u1(i)))&&...
         ~(DV1S_eig(1)>0 && DV1S_eig(2)>0 && P1S_eig(1)>0 && P1S_eig(2)>0) && (u1(i)~=0 && u2(i)~=0))
        x1_3(i)=u1(i); x2_3(i)=u2(i);
        if (u1(i)<min_u1)
            min_u1=u1(i);
        end 
    else
        x1_3(i)=0; x2_3(i)=0;
    end
    
    if (((u1(i)>=0 && u1(i)<=2 && u2(i)>=0 && u2(i)<=1) && (u2(i)>=u1(i)/2 && u2(i)<=u1(i)))&&...
     (DV1S_eig(1)>0 && DV1S_eig(2)>0 && P1S_eig(1)>0 && P1S_eig(2)>0) && (u1(i)~=0 && u2(i)~=0))
%         if (u1(i)<min_u1)
%             min_u1=u1(i);
%         end
        if (u1(i)>max_u1)
            max_u1=u1(i);
        end
    end
end


set(gcf,'position',[600,40,468,350],'PaperPositionMode','auto');
set(gcf,'color','w');
p1_axis = gca; 
scatter(x1_1,x2_1,0.1,...
                    'LineWidth',0.01,...  
                    'DisplayName','$ \mathcal K $',...
                    'MarkerEdgeColor',[0.0745098039215686 0.623529411764706 1],...
                    'MarkerFaceColor',[0.0745098039215686 0.623529411764706 1] ); 
hold on
% scatter(x1_2,x2_2,0.1,...
%                     'LineWidth',0.01,...  
%                     'DisplayName','$ \mathcal K $',...
%                     'MarkerEdgeColor',[0.568627450980392 0.258823529411765 0.858823529411765],...
%                     'MarkerFaceColor',[0.568627450980392 0.258823529411765 0.858823529411765] );
% hold on
% scatter(x1_3,x2_3,0.1,...
%                     'LineWidth',0.01,...  
%                     'DisplayName','$ \mathcal K $',...
%                     'MarkerEdgeColor',[1 0.2 0.1],...
%                     'MarkerFaceColor',[1 0.2 0.1] );
hold on
                            
xlabel('$ {{\hat{u}}_{1,k}} $','Interpreter','latex');
ylabel('$ {{\hat{u}}_{2,k}} $','Interpreter','latex');