
% clc
% clear
x_axis=0:0.005:2;
y_axis=0:0.005:2;

m=size(x_axis,2);
n=size(y_axis,2);

u1=zeros(m*n,1);
u2=zeros(m*n,1);

min_u1=1000;

x1_1=zeros(m*n,1);
x2_1=zeros(m*n,1);

x1_2=zeros(m*n,1);
x2_2=zeros(m*n,1);

x1_3=zeros(m*n,1);
x2_3=zeros(m*n,1);

x1_4=zeros(m*n,1);
x2_4=zeros(m*n,1);

x1_5=zeros(m*n,1);
x2_5=zeros(m*n,1);

for i=1:m
    for j=1:n
        u1( (i-1)*n+j )=x_axis(i);
        u2( (i-1)*n+j )=y_axis(j);
    end
end

score=1;

% [1.49504534885141,9.14416891635604,3.02304921199904,0.905756902578500,0.956203619789844,7.64486875278753,3.49525009839326,0.454250329095063]
% x=[15.3410577512253,107.288300802618,1.72707387554316,47.4082292222562,67.3361105395089,115.426519424393,33.4516104440043,95.2614172393100,38.3018675063321,140.835140727798,86.5434498578030,2.26520342561447,55.2154552605688,34.8006382645027,77.9342079927754,93.1002205391334,1.49504534885141,9.14416891635604,3.02304921199904,0.905756902578500,0.956203619789844,7.64486875278753,3.49525009839326,0.454250329095063]

% x=[5.29004602370707,6.27878970494364,2.19014031470241,6.30500358473331,1.38471122824842,5.67707871094981,3.48199883867618,0.0826695143320430]
% x=[5.22068086821557,8.93180707314556,6.90044326956146,0.878035075084104,6.83871326103101,2.16797963230644,4.84588435956439,6.15293106865946,5.49897093835566,9.34553727414404,7.12235780261832,5.11178610906011,2.23594936990331,9.06588055755291,5.76164061069632,0.339536897761582]
% x=[6.06728783204881,7.99301981018162,5.07472148266123,6.62377241068337,-5.61668034891236,8.74182735920617,9.30889533894879,8.78426312741914,5.15836466493554,-0.687109061704891,-5.49476519195393,2.04773033413987,8.08845170858902,-4.45273499224843,7.74911274424965,2.81109648443643]
% x=[4.28500142896641,4.39974689910712,2.82702475199329,3.03045889536326,0.349217551197643,5.43126967965994,1.30933503918997,0.728773056847349,3.98248412874027,-2.86148740672901,-0.425840910918229,-1.78926718908527,1.19791893423987,4.00990836085798,2.15393016268590,0.188429390377697]
x=[2.82299263570859,-7.41333556786427,-3.09864710148640,2.87802992208106,2.30263988016187,8.97978975175325,-0.0128125336857869,-5.74524181530116,5.78915651760164,7.31556503085942,-1.64983814474715,-6.42367609943397,-0.432453770503805,-3.96490886617826,-6.78169933467135,-2.17229916022303];

is_valid=true;
u2_max_set=1;
max_x1=0;
max_u1=0;
max_u2=0;
h=0.6;
  
for i=1:m*n
    P1=[x(1), x(3)*h; 
        x(4)*h, x(2)*h^2];
    P2=[x(5), x(7)*h; 
        x(8)*h, x(6)*h^2];
    P3=[x(9), x(11)*h; 
        x(12)*h, x(10)*h^2];
    P4=[x(13), x(15)*h; 
        x(16)*h, x(14)*h^2];
   
    P1S=(P1+P1')/2; P2S=(P2+P2')/2; P3S=(P3+P3')/2; P4S=(P4+P4')/2;
    P1S_eig=real(eig(P1S)); P2S_eig=real(eig(P2S)); P3S_eig=real(eig(P3S)); P4S_eig=real(eig(P4S));
    
    M1=[u1(i)-1,h; (u2(i)-1)/h,1];
    
    DV1=-(M1'*P1*M1-P1);
    DV2=-(M1'*P2*M1-P2);
    DV3=-(M1'*P3*M1-P3);
    DV4=-(M1'*P4*M1-P4);
    
    DV1S=(DV1+DV1')/2;  DV2S=(DV2+DV2')/2;  DV3S=(DV3+DV3')/2;  DV4S=(DV4+DV4')/2;
    DV1S_eig=real(eig(DV1S)); DV2S_eig=real(eig(DV2S)); DV3S_eig=real(eig(DV3S)); DV4S_eig=real(eig(DV4S)); 
     
    if((DV1S_eig(1)>0 && DV1S_eig(2)>0 && P1S_eig(1)>0 && P1S_eig(2)>0)||...
       (DV2S_eig(1)>0 && DV2S_eig(2)>0 && P2S_eig(1)>0 && P2S_eig(2)>0)||...
       (DV3S_eig(1)>0 && DV3S_eig(2)>0 && P3S_eig(1)>0 && P3S_eig(2)>0)||...
       (DV4S_eig(1)>0 && DV4S_eig(2)>0 && P4S_eig(1)>0 && P4S_eig(2)>0))
        x1_1(i)=u1(i); x2_1(i)=u2(i);
    else
        x1_1(i)=0; x2_1(i)=0;
    end       
    
    if ((u1(i)>=0 && u1(i)<=2 && u2(i)>=0 && u2(i)<=u2_max_set) && (u2(i)>u1(i)/2 && u2(i)<=u1(i)))||(u1(i)==0 && u2(i)==0) 
       x1_2(i)=u1(i); x2_2(i)=u2(i);
    else
       x1_2(i)=0; x2_2(i)=0;
    end


    if (((u1(i)>=0 && u1(i)<2 && u2(i)>=0 && u2(i)<=u2_max_set) && (u2(i)>u1(i)/2 && u2(i)<=u1(i)))&&...
         ~((DV1S_eig(1)>0 && DV1S_eig(2)>0 && P1S_eig(1)>0 && P1S_eig(2)>0)||...
           (DV2S_eig(1)>0 && DV2S_eig(2)>0 && P2S_eig(1)>0 && P2S_eig(2)>0)||...
           (DV3S_eig(1)>0 && DV3S_eig(2)>0 && P3S_eig(1)>0 && P3S_eig(2)>0)||...
           (DV4S_eig(1)>0 && DV4S_eig(2)>0 && P4S_eig(1)>0 && P4S_eig(2)>0)) && (u1(i)~=0 && u2(i)~=0))
        x1_3(i)=u1(i); x2_3(i)=u2(i);
        if (u1(i)<min_u1)
            min_u1=u1(i);
        end 
    else
        x1_3(i)=0; x2_3(i)=0;
    end
    
end


set(gcf,'position',[600,40,468,350],'PaperPositionMode','auto');
set(gcf,'color','w');
p1_axis = gca; 
scatter(x1_1,x2_1,0.1,...
                    'LineWidth',0.01,...  
                    'DisplayName','$ \mathcal K $',...
                    'MarkerEdgeColor',[0.0745098039215686 0.623529411764706 1],...
                    'MarkerFaceColor',[0.0745098039215686 0.623529411764706 1] ); 
hold on
scatter(x1_2,x2_2,0.1,...
                    'LineWidth',0.01,...  
                    'DisplayName','$ \mathcal K $',...
                    'MarkerEdgeColor',[0.568627450980392 0.258823529411765 0.858823529411765],...
                    'MarkerFaceColor',[0.568627450980392 0.258823529411765 0.858823529411765] );
hold on
scatter(x1_3,x2_3,0.1,...
                    'LineWidth',0.01,...  
                    'DisplayName','$ \mathcal K $',...
                    'MarkerEdgeColor',[1 0.2 0.1],...
                    'MarkerFaceColor',[1 0.2 0.1] );

                            
xlabel('$ {{\hat{u}}_{1,k}} $','Interpreter','latex');
ylabel('$ {{\hat{u}}_{2,k}} $','Interpreter','latex');